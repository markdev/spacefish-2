<!DOCTYPE html>
<head>
    <style>
        canvas#canvas { background-color: #000; }
        #results li.pass { color: green; }
        #results li.fail { color: red; }
    </style>
    <script src="jquery-1.9.0.min.js"></script>
    <script src="myFunctions.js"></script>
</head>
<body>

    <canvas id="canvas" height="700" width="1200">Joo cannot see me!</canvas>

    <ul id="results"></ul>

    <script>
        var Game = function () {
            this.canvas = document.getElementById("canvas");
            this.ctx = canvas.getContext("2d");
            this.bufferCanvas = document.createElement("canvas");
            this.bufferCanvasCtx = this.bufferCanvas.getContext("2d");
            this.bufferCanvasCtx.canvas.width = this.ctx.canvas.width;
            this.bufferCanvasCtx.canvas.height = this.ctx.canvas.height;

            this.intervals = [];

            this.time = 0;
            this.startTime = 0;

            this.currentLevel = "";
            this.events = [];
            this.score = 0;
            this.lives = 3;
            this.img = {};
            this.imgArray = [
                "AGHeads", "bigBloater", "bigBloaterA", "bigBloaterB", "crabCakesA",
                "crabCakesB", "darkBack", "homingFishA", "homingFishB", "orbbouncy",
                "orbdrill", "orbhellfire", "orbhoming", "orblaser", "orbmega", "orbshock",
                "planetview", "seasky", "sinusoidSwimmerA", "sinusoidSwimmerB", "spaceShip",
                "spaceShipA", "spaceShipB", "spaceShipMegaA", "spaceShipMegaB", "spaceShipShield",
                "spaceShipShieldA", "spaceShipShieldB", "speedyBlueA", "speedyBlueB", "spitFireBulletA",
                "spitFireBulletB", "spitFireFishA", "spitFireFishB", "splitFishBigA", "splitFishBigB",
                "splitFishSmallA", "splitFishSmallB", "startScreen", "theSea", "trippyeyeballs",
                "youLose", "youWin"
            ];
        };

        Game.prototype = {
            loadImage : function loadImage(i) {     // naming this function makes it accessible only for self-reference; it is not globally accessible
                i = (typeof i !== 'undefined') ? i : 0;
                var image = new Image();
                image.src = 'images/' + game.imgArray[i] + '.png';
                image.onload = function(e) {
                    window['game']['img'][game.imgArray[i]] = image;
                    i++;
                    if (i < game.imgArray.length) {
                        loadImage(i);   // see, that was painless
                    } else {
                        // <!-- Move this into a script later
                        window.spaceFishData = {
                            splashScreen : {
                                "type" : "basicSplashScreen",   // Integrate this
                                "background" : "startScreen",
                                "flashText" : { x: 500, y: 600, content: "Click to continue", font: "20pt Arial", color: "white"},
                                "events" : [
                                    {"event" : "mousedown", "action" : function() {game.loadGameLoop("levelOne");}}
                                            ]
                            },
                            levelOne : {
                                "type" : "sideScrollLevel",
                                "background" : "theSea",
                                "timer" : 20,
                                "opponents" : ["Darren", "Frank"]
                            },
                            secondScreen : {
                                "type" : "basicSplashScreen",
                                "background" : "youWin",
                                "flashText" : { x: 500, y: 600, content: "Click to start over", font: "20pt Arial", color: "white"},
                                "events" : [
                                    {"event" : "mousedown", "action" : function() {game.loadGameLoop("splashScreen");}}
                                            ]
                            },
                            loseScreen : {
                                "type" : "basicSplashScreen",
                                "background" : "youLose",
                                "flashText" : { x: 500, y: 600, content: "Click to start over", font: "20pt Arial", color: "white"},
                                "events" : [
                                    {"event" : "mousedown", "action" : function() {game.initialize();}}
                                ]
                            }
                        }
                        // --> move this into a script later
                        game.initialize();
                    }
                };
            },

            initialize : function() {
                game.lives = 3;
                game.gameLoop = new GameLoop("nullScreen");           // TODO: This is a hideous solution to not being able to call game.gameLoop.cancelAnimationFrame conditionally
                game.loadGameLoop("splashScreen");
            },

            removeListeners : function(listener) {
                game.canvas.removeEventListener(listener.event, listener.action);
            },

            addListeners : function(listener) {
                game.canvas.addEventListener(listener.event, listener.action);
            },

            loadGameLoop : function(gameScreen) {
                // start gameLoop
                game.gameLoop.cancelAnimationFrame = true;          // TODO: find a way to do this conditionally, without having to load the null screen
                var gameScreen = (typeof gameScreen === "undefined")? "splashScreen" : gameScreen;
                game.currentLevel = gameScreen;
                var d = new Date();
                var n = String(d.getTime());
                game.startTime = n.substring(10);
                this.gameLoop = new GameLoop(spaceFishData[gameScreen]);

                // remove all the event handlers and empty this.events
                if (this.events.length > 0) {
                    for (var i=0, len=this.events.length-1; i<=len; i++) {
                        game.removeListeners(this.events[0]);
                        this.events.shift();
                    }
                }
                // load this.events and add handlers
                if (this.events.length == 0) {
                    // load from game data
                    if (spaceFishData[gameScreen].hasOwnProperty('events')) {       // TODO: see if these two if/for loops can be refactored
                        for (var i=0; i<=spaceFishData[gameScreen]['events'].length-1; i++) {
                            this.events[this.events.length] = spaceFishData[gameScreen]['events'][i];
                            game.addListeners(this.events[this.events.length-1]);
                        }
                    }
                    // load from level function
                    if (window[spaceFishData[gameScreen].type].hasOwnProperty('events')) {
                        for (var i=0; i<=window[spaceFishData[gameScreen].type].events.length-1; i++) {
                            this.events[this.events.length] = window[spaceFishData[gameScreen].type]['events'][i];
                            game.addListeners(this.events[this.events.length-1]);
                        }
                    }
                }

                // assign members to this.gameLoop from levelData
                for (var key in spaceFishData[gameScreen]) {
                    this.gameLoop[key] = spaceFishData[gameScreen][key];
                }
                extend(this.gameLoop, window[spaceFishData[gameScreen].type]);

                // clear all the existing intervals
                if (typeof game.intervals[0] !== 'undefined') {
                    for (var i=0; i<=game.intervals.length-1; i++) {
                        clearInterval(game.intervals[i]);
                    }
                }

                // start this shit
                this.gameLoop.initialize();

                // run the animation loop
                this.gameLoop.animate();
            }
        }

       var GameLoop = function(level) {
            var self = this;
            this.cancelAnimationFrame = false;
            this.initialize = function() {};
            this.clearScreen = function() {};
            this.update = function() {};
            this.render = function() {};
            this.drawbuffer = function() {
                game.ctx.drawImage(game.bufferCanvas, 0, 0, game.bufferCanvas.width, game.bufferCanvas.height);
            };
            this.animate = function(time) {
                game.time = time;
                self.clearScreen();
                self.update();
                self.render();
                self.drawbuffer();
       //         console.log(time);
                if (self.cancelAnimationFrame == false) {
                    requestAnimationFrame(self.animate);
                }
            };
       }

       /*
       *    GameLoop Level Types
       *
        */
       var nullScreen = {};

       var basicSplashScreen = {
            "clearScreen" : function() {
                game.bufferCanvasCtx.drawImage(window['game']['img'][this.background], 0, 0);
            },
            "update" : function() {
                var d = new Date();
                var n = String(d.getTime());
                if (n.substring(10) > 500) {
                    game.bufferCanvasCtx.font = this.flashText.font;
                    game.bufferCanvasCtx.fillStyle = this.flashText.color;
                    game.bufferCanvasCtx.fillText(this.flashText.content, this.flashText.x, this.flashText.y);
                }
            }
       }

       var sideScrollLevel = {
            "initialize" : function() {
                game.playerArray = [];
                game.playerProjectileArray = [];
                game.enemyProjectileArray = [];
                game.opponentArray = [];
                game.itemArray = [];
                game.playerArray[game.playerArray.length] = new sideScrollLevel.SpaceShip();
                game.intervals[game.intervals.length] = setInterval(this.generateOpponent, 1000);
            },
            "generateOpponent" : function () {
                var opponentName = spaceFishData[game.currentLevel]['opponents'][Math.floor(Math.random() * spaceFishData[game.currentLevel]['opponents'].length)];
                game.opponentArray[game.opponentArray.length] = new sideScrollLevel.Opponent(sideScrollLevel['OpponentData'][opponentName]);
            },
            "generateItem" : function (opponentName, x, y) {
                game.itemArray[game.itemArray.length] = new sideScrollLevel.Item(opponentName, x, y+sideScrollLevel['OpponentData'][opponentName]['h']/2, sideScrollLevel['ItemData'][sideScrollLevel['OpponentData'][opponentName]["item"]]);
            },
            "clearScreen" : function() {
                game.bufferCanvasCtx.fillStyle = "black";
                game.bufferCanvasCtx.fillRect(0, 0, game.bufferCanvasCtx.canvas.width, game.bufferCanvasCtx.canvas.height);
            },
            "update" : function() {  // TODO: see if these functions can be refactored
                // Player Projectiles
                if (typeof game.playerProjectileArray[0] !== "undefined") {
                    for (var i=0; i<=game.playerProjectileArray.length-1; i++) {
                        game.playerProjectileArray[i].update();
                        game.playerProjectileArray[i].detectCollision(i, "opponentArray");
                    }
                    // Remove blasts from projectileArray when they fly off the screen
                    for (var i=0; i<=game.playerProjectileArray.length-1; i++) {
                        if (game.playerProjectileArray[i].x > canvas.width)  game.playerProjectileArray.splice(i,1);
                    }
                }
                // Enemy Projectiles
                if (typeof game.enemyProjectileArray[0] !== "undefined") {
                    for (var i=0; i<=game.enemyProjectileArray.length-1; i++) {
                        game.enemyProjectileArray[i].update();
                        game.enemyProjectileArray[i].detectCollision(i, "playerArray");
                    }
                    // Remove blasts from projectileArray when they fly off the screen
                    for (var i=0; i<=game.enemyProjectileArray.length-1; i++) {
                        if (game.enemyProjectileArray[i].x < 0)  game.enemyProjectileArray.splice(i,1);
                    }
                }
                // Opponents
                if (typeof game.opponentArray[0] !== "undefined") {
                    for (var i=0; i<=game.opponentArray.length-1; i++) {
                        game.opponentArray[i].update();
                        game.opponentArray[i].detectCollision(i);
                    }
                    // Remove opponents that have flown off the screen
                    for (var i=0; i<=game.opponentArray.length-1; i++) {
                        if (game.opponentArray[i].x < -(game.opponentArray[i].w)) game.opponentArray.splice(i,1);
                    }
                }
                // Items
                if (typeof game.itemArray[0] !== "undefined") {
                    for (var i=0; i<=game.itemArray.length-1; i++) {
                        game.itemArray[i].update();
                        game.itemArray[i].detectCollision(i);
                    }
                    // Remove items that have flown off the screen
                    for (var i=0; i<=game.itemArray.length-1; i++) {
                        if (game.itemArray[i].x < -(game.itemArray[i].w)) game.itemArray.splice(i,1);
                    }
                }
                console.log(game.playerArray[0].mode);
            },
            "render" : function() {
                for (var i=0; i<game.playerArray.length; i++) {
                    game.bufferCanvasCtx.drawImage(game['img'][game.playerArray[i].image], game.playerArray[i].x, game.playerArray[i].y, game.playerArray[i].w, game.playerArray[i].h);
                }
                if (typeof game.playerProjectileArray[0] !== "undefined") {
                    for (var i=0; i<=game.playerProjectileArray.length-1; i++) {
                        game.bufferCanvasCtx.fillStyle = game.playerProjectileArray[i].color;
                        game.bufferCanvasCtx.beginPath();
                        game.bufferCanvasCtx.arc(game.playerProjectileArray[i].x, game.playerProjectileArray[i].y, game.playerProjectileArray[i].radius, 0, 2 * Math.PI);
                        game.bufferCanvasCtx.fill();
                    }
                }
                if (typeof game.enemyProjectileArray[0] !== "undefined") {
                    for (var i=0; i<=game.enemyProjectileArray.length-1; i++) {
                        game.bufferCanvasCtx.fillStyle = game.enemyProjectileArray[i].color;
                        game.bufferCanvasCtx.beginPath();
                        game.bufferCanvasCtx.arc(game.enemyProjectileArray[i].x, game.enemyProjectileArray[i].y, game.enemyProjectileArray[i].radius, 0, 2 * Math.PI);
                        game.bufferCanvasCtx.fill();
                    }
                    console.log(game.enemyProjectileArray.length);
                }
                if (typeof game.opponentArray[0] !== "undefined") {
                    for (var i=0; i<=game.opponentArray.length-1; i++) {
                        game.bufferCanvasCtx.drawImage(game['img'][game.opponentArray[i].img], game.opponentArray[i].x, game.opponentArray[i].y, game.opponentArray[i].w, game.opponentArray[i].h);
                    }
                }
                if (typeof game.itemArray[0] !== "undefined") {
                    for (var i=0; i<=game.itemArray.length-1; i++) {
                        game.bufferCanvasCtx.drawImage(game['img'][game.itemArray[i].img], game.itemArray[i].x, game.itemArray[i].y, game.itemArray[i].w, game.itemArray[i].h);
                    }
                }
                // render time // TODO make this sensible
                game.bufferCanvasCtx.font = "20pt Arial";
                game.bufferCanvasCtx.fillStyle = "white";
                game.bufferCanvasCtx.fillText(String(game.time - game.startTime).substring(0,2), 100, 100);
            },
            "events" : [
                {"event" : "mousedown", "action" : function() {
                    sideScrollLevel['WeaponData'][game.playerArray[0].weapon]["fire"]();
                }},
                {"event" : "mousemove", "action" : function(e) {
                    if (typeof game.playerArray[0] !== "undefined") {
                       game.playerArray[0].y = e.pageY;
                    }
                }}
            ],
           "hitSpaceShip" : function(opponentId) {
               game.playerArray[0].getHit();
               game.opponentArray.splice(opponentId, 1);
           },
           "killPlayer" : function() {
               game.lives -= 1;
               if (game.lives > 0) {
                   game.loadGameLoop("levelOne");
               } else {
                   game.loadGameLoop("loseScreen");
               }
           },
           "loadItem" : function(itemId) {
               game.itemArray[itemId].action();
               game.itemArray.splice(itemId,1);
           },

           /*
            *    Game Object Prototypes
            *
            */
           "SpaceShip" : function () {
               this.x = 0;
               this.y = canvas.height/2;
               this.w = 120;
               this.h = 60;
               this.health = 1;
               this.mode = "normal";
               this.image = "spaceShipA";
               this.weapon = "dualLaser";
               this.getHit = function () {
                   if (this.mode == "mega") {
                       this.mode = "normal";
                       this.h = 60;
                       this.w = 120;
                       this.health = 1;
                       this.image = "spaceShipA";
                   } else if (this.mode == "drill") {
                       // nothing happens!  //TODO: add effect?
                   } else if (this.mode == "normal") {
                       this.health -= 1;
                       sideScrollLevel.killPlayer();
                   }
               };
               this.megaMode = function () {
                   this.mode = "mega";
                   this.h = 80;
                   this.w = 120;
                   this.health = 2;
                   this.image = "spaceShipMegaA";
               };
               this.drillMode = function () {
                   this.mode = "drill";
                   this.h = 60;
                   this.w = 145;
                   this.health = 1;
                   this.image = "spaceShipShieldA";
               }
           },

           "Blast" : function (x, velx, y, vely, radius, color, update) {
               this.x = x; //game.playerArray[0].w;
               this.velx = velx;
               this.y = y;
               this.vely = vely;
               this.radius = radius;
               this.color = color;
               this.update = update;
               this.detectCollision = function(blastId, targetArray) {
                   for (var i=0; i<=game[targetArray].length-1; i++) {
                       if (this.x > game[targetArray][i].x && this.x < game[targetArray][i].x + game[targetArray][i].w &&
                           this.y > game[targetArray][i].y && this.y < game[targetArray][i].y + game[targetArray][i].h) {
                           game[targetArray][i].getHit(i);
                           game.playerProjectileArray.splice(blastId,1);
                       }
                   }
               };
           },

           "Opponent" : function (opponentData, x, y, velx, vely) {
               var self = this;
               this.name = opponentData.name;
               this.w = opponentData.w;
               this.h = opponentData.h;
               this.x = (typeof x !== 'undefined') ? x : canvas.width;
               this.y = (typeof y !== 'undefined') ? y : Math.random() * (canvas.height - this.h);
               this.velx = (typeof velx !== 'undefined') ? velx : opponentData.velx;
               this.vely = (typeof vely !== 'undefined') ? vely : opponentData.vely;
               this.img = opponentData.img;
               this.update = opponentData.update;
               this.detectCollision = function(opponentId) {
                   if (  game.playerArray[0].x + game.playerArray[0].w/2 > game.opponentArray[opponentId].x &&
                         game.playerArray[0].x < game.opponentArray[opponentId].x + game.opponentArray[opponentId].w &&
                         game.playerArray[0].y + game.playerArray[0].h > game.opponentArray[opponentId].y &&
                         game.playerArray[0].y < game.opponentArray[opponentId].y + game.opponentArray[opponentId].h) {
                         sideScrollLevel.hitSpaceShip(opponentId);
                   }
               };
               this.getHit = function(i) {      // TODO: Move this to its rightful spot
                   if (self.name === "Darren") {
                       game.opponentArray[game.opponentArray.length] = new sideScrollLevel.Opponent(sideScrollLevel['OpponentData']['Dylan'], game.opponentArray[i].x, game.opponentArray[i].y, undefined, 5);
                       game.opponentArray[game.opponentArray.length] = new sideScrollLevel.Opponent(sideScrollLevel['OpponentData']['Dylan'], game.opponentArray[i].x, game.opponentArray[i].y, undefined, 0);
                       game.opponentArray[game.opponentArray.length] = new sideScrollLevel.Opponent(sideScrollLevel['OpponentData']['Dylan'], game.opponentArray[i].x, game.opponentArray[i].y, undefined, -5);
                       game.opponentArray.splice(i,1);
                   } else {
                       sideScrollLevel.generateItem(game.opponentArray[i].name, game.opponentArray[i].x, game.opponentArray[i].y);
                       game.opponentArray.splice(i,1);
                   }
               }
           },

           "Item" : function(name, x, y, itemData) {  // TODO: make this dynamic so that it is called by the opponent
               this.name = name;
               this.x = x;
               this.y = y;
               this.w = 40; // TODO: change this to a radius maybe
               this.h = 40;
               this.img = itemData.img;
               this.update = function () {
                    this.x -= 4;
               };
               this.action = itemData.action;
               this.detectCollision = function(itemId) {
                    if ( game.playerArray[0].x + game.playerArray[0].w/2 > game.itemArray[itemId].x &&
                         game.playerArray[0].x < game.itemArray[itemId].x + game.itemArray[itemId].w &&
                         game.playerArray[0].y + game.playerArray[0].h > game.itemArray[itemId].y &&
                         game.playerArray[0].y < game.itemArray[itemId].y + game.itemArray[itemId].h) {
                         sideScrollLevel.loadItem(itemId);
                    }
               }
           },

           /*
           *    Game Object Data
           *
            */
           "OpponentData" : {
               "Bill" : { "name" : "Bill", "w" : 300, "h" : 150, "velx" : 15, "img" : "bigBloaterA", "item" : "mega", "update" : function() {this.x -= this.velx;}},
               "Sam" : { "name" : "Sam", "w" : 150, "h" : 75, "velx" : 20, "img" : "speedyBlueA", "item" : "dualLaser", "update" : function() {this.x -= this.velx;}},
               "Luciano" : { "name" : "Luciano", "w" : 200, "h" : 300, "velx" : 25, "img" : "sinusoidSwimmerA", "item" : "shockWave", "update" : function() {this.x -= this.velx; var sin = Math.sin(this.x * 2.5) * 80; this.y += sin;}},
               "Homer" : { "name" : "Homer", "w" : 230, "h" : 115, "velx" : 35, "img" : "homingFishA", "item" : "homingMissile", "update" : function() {this.x -= this.velx; this.y += ((this.y + this.h/2) > game.playerArray[0].y)? -10 : 10;}},
               "Darren" : { "name" : "Darren", "w" : 250, "h" : 250, "velx" : 15, "img" : "splitFishBigA", "item" : "dualLaser", "update" : function() {this.x -= this.velx;}},
               "Dylan" : { "name" : "Dylan", "w" : 125, "h" : 75, "velx" : 25, "img" : "splitFishSmallA", "item" : "bouncyBalls", "update" : function() {this.x -= this.velx; this.y -= this.vely;}},
               "Frank" : { "name" : "Frank", "w" : 300, "h" : 150, "velx" : 15, "img" : "spitFireFishA", "item" : "drill", "update" : function() {this.x -= this.velx;  if (this.x >700 && this.x < 720) {game.enemyProjectileArray[game.enemyProjectileArray.length] = new sideScrollLevel.Blast(this.x, -20, this.y + this.h/2, 0, 10, "orange", function () {this.x += this.velx})}}},
               "CrabCakes" : { "name" : "CrabCakes", "w" : 200, "h" : 200, "velx" : 20, "vely" : 4, "img" : "crabCakesA", "item" : "hellFire", "update" : function() {
                   this.x -= this.velx;
                   if (this.x < 0) this.velx = -this.velx;
                   if (this.x + this.w > canvas.width && this.velx < 0) this.velx = -this.velx;
                   this.y -= this.vely;
                   if (this.y < 0) this.vely = -this.vely;
                   if (this.y + this.h > canvas.height && this.vely < 0) this.vely = -this.vely;
               }}
           },
           "ItemData" : {
               "mega" : {"name" : "Mega", "img" : "orbmega", "action" : function () {game.playerArray[0].megaMode();}},
               "dualLaser" : {"name" : "Dual Laser", "img" : "orblaser", "action" : function () {game.playerArray[0].weapon = "dualLaser";}},
               "shockWave" : {"name" : "Shock Wave", "img" : "orbshock", "action" : function () {game.playerArray[0].weapon = "shockWave";}},
               "homingMissile" : {"name" : "Homing Missile", "img" : "orbhoming", "action" : function () {game.playerArray[0].weapon = "homingMissile";}},
               "bouncyBalls" : {"name" : "Bouncy Balls", "img" : "orbbouncy", "action" : function () {game.playerArray[0].weapon = "bouncyBalls";}},
               "drill" : {"name" : "Drill", "img" : "orbdrill", "action" : function () {game.playerArray[0].drillMode();}},
               "hellFire" : {"name" : "Hell Fire", "img" : "orbhellfire", "action" : function () {game.playerArray[0].weapon = "hellFire";}}
           },
           "WeaponData" : {     // TODO: figure out whether to put this with itemData, not sure yet
               "peaShooter" : {"fire" : function() {game.playerProjectileArray[game.playerProjectileArray.length] = new sideScrollLevel.Blast(game.playerArray[0].w, 5, game.playerArray[0].y + game.playerArray[0].h/2, 1, 10, "white", function () {this.x += this.velx})}},
               "dualLaser" : {"fire" : function() {game.playerProjectileArray[game.playerProjectileArray.length] = new sideScrollLevel.Blast(game.playerArray[0].w, 10, (game.playerArray[0].y + game.playerArray[0].h/2)-15, 1, 7, "red", function () {this.x += this.velx});
                                                    game.playerProjectileArray[game.playerProjectileArray.length] = new sideScrollLevel.Blast(game.playerArray[0].w, 10, (game.playerArray[0].y + game.playerArray[0].h/2)+15, 1, 7, "red", function () {this.x += this.velx});}},
               "shockWave" : {"fire" : function() {game.playerProjectileArray[game.playerProjectileArray.length] = new sideScrollLevel.Blast(game.playerArray[0].w, 10, game.playerArray[0].y + game.playerArray[0].h/2, 1, 10, "yellow", function () {this.x += this.velx; var sin = Math.sin(this.x * 2.5) * 8; this.y += sin;})}},
               "homingMissile" : {"fire" : function() {game.playerProjectileArray[game.playerProjectileArray.length] = new sideScrollLevel.Blast(game.playerArray[0].w, 5, game.playerArray[0].y + game.playerArray[0].h/2, 1, 20, "red", function () {
                   if (game.opponentArray.length > 0) {this.y += (game.opponentArray[game.opponentArray.length-1].y - this.y) * .05;}
                   this.x += this.velx;
               })}},
               "bouncyBalls" : {"fire" : function() { game.playerProjectileArray[game.playerProjectileArray.length] = new sideScrollLevel.Blast(game.playerArray[0].w, 10, game.playerArray[0].y + game.playerArray[0].h/2, Math.round(Math.random()*2 - 1) * 10, 10, "purple", function () {
                   this.x += this.velx;
                   this.y += this.vely;
                   if (this.y < 0) this.vely = -this.vely;
                   if (this.y + this.radius > canvas.height) this.vely = -this.vely;
                   })
               }},
               "hellFire" : {"fire" : function() {game.playerProjectileArray[game.playerProjectileArray.length] = new sideScrollLevel.Blast(game.playerArray[0].w, Math.round(Math.random()*20 - 10), game.playerArray[0].y + game.playerArray[0].h/2, Math.round(Math.random()*20 - 10), 10, "red", function () {
                   this.x += this.velx;
                   if (this.x < 0) this.velx = -this.velx;
                   if (this.x + this.radius > canvas.width && this.velx > 0) this.velx = -this.velx;
                   this.y -= this.vely;
                   if (this.y < 0) this.vely = -this.vely;
                   if (this.y + this.radius > canvas.height && this.vely < 0) this.vely = -this.vely;
               })}}
           }
       }
        var game = new Game();
        game.loadImage();
    </script>
</body>
</html>