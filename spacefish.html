<!DOCTYPE html>
<head>
    <style>
        canvas#canvas { background-color: #000; }
        #results li.pass { color: green; }
        #results li.fail { color: red; }
    </style>
    <script src="jquery-1.9.0.min.js"></script>
    <script src="myFunctions.js"></script>
<!--<script src="mark.js"></script>
    <script src="spacefish.js"></script>        -->

</head>
<body>

    <canvas id="canvas" height="700" width="1200">Joo cannot see me!</canvas>

    <ul id="results"></ul>

    <script>
            var Game = function () {
                this.canvas = document.getElementById("canvas");
                this.ctx = canvas.getContext("2d");
                this.bufferCanvas = document.createElement("canvas");
                this.bufferCanvasCtx = this.bufferCanvas.getContext("2d");
                this.bufferCanvasCtx.canvas.width = this.ctx.canvas.width;
                this.bufferCanvasCtx.canvas.height = this.ctx.canvas.height;
                this.objects = [];
                this.events = [];
                this.score = 0;
                this.lives = 3;
            };
            var game = new Game();
            game.img = {};
            var imgArray = [
                "AGHeads", "bigBloater", "bigBloaterA", "bigBloaterB", "crabCakesA",
                "crabCakesB", "darkBack", "homingFishA", "homingFishB", "orbbouncy",
                "orbdrill", "orbhellfire", "orbhoming", "orblaser", "orbmega", "orbshock",
                "planetview", "seasky", "sinusoidSwimmerA", "sinusoidSwimmerB", "spaceShip",
                "spaceShipA", "spaceShipB", "spaceShipMegaA", "spaceShipMegaB", "spaceShipShield",
                "spaceShipShieldA", "spaceShipShieldB", "speedyBlueA", "speedyBlueB", "spitFireBulletA",
                "spitFireBulletB", "spitFireFishA", "spitFireFishB", "splitFishBigA", "splitFishBigB",
                "splitFishSmallA", "splitFishSmallB", "startScreen", "theSea", "trippyeyeballs",
                "youLose", "youWin"
            ];

            (function loadImage(i) {
                i = (typeof i !== 'undefined') ? i : 0;
                var image = new Image();
                image.src = 'images/' + imgArray[i] + '.png';
                image.onload = function(e) {
                    window['game']['img'][imgArray[i]] = image;
                    i++;
                    if (i < imgArray.length) {
                        loadImage(i);
                    } else {
                        var gameData = {
                            "splashScreen" : {"screen" : game.img.startScreen, "events" : function() {
                                game.canvas.addEventListener('mousedown', function() {alert("I've been pressed");}, false);
                            }},
                            "secondScreen" : {}
                        }
                        loadGame(gameData);
                    }
                };
            }());

            var testObj = { x:0, y:0 }

            var GameLoop = function(screen) {
                var self = this;
                this.deleteEventHandlers = function() { game.events = []; assert(game.events.length == 0, "Events is empty"); }
                this.deleteGameObjects = function() { game.objects = []; assert(game.objects.length == 0, "Objects is empty"); }
                this.createEventHandlers = screen.events;
                this.createGameObjects = function() { assert(true, "I am setting new game objects"); }
                this.clearScreen = function() {
                    game.ctx.drawImage(screen.screen, 0, 0);
                }
                this.update = function() {
                    testObj.x++;
                    testObj.y++;
                }
                this.render = function() {
                    game.ctx.fillStyle = "yellow";
                    game.ctx.fillRect(testObj.x, testObj.y, 100, 100);
                }
                this.animate = function() {
                    self.clearScreen();
                    self.update();
                    self.render();
                    requestAnimationFrame(self.animate);
                }
            }

            function loadGame(gameData) {
                var gameLoop = new GameLoop(gameData.splashScreen);
                for (var fn in gameLoop) {
                    if (typeof gameLoop[fn] == "function") {
                        gameLoop[fn]();
                    }
                }
            }

    </script>


</body>
</html>
