<!DOCTYPE html>
<head>
    <style>
        canvas#canvas { background-color: #000; }
        #results li.pass { color: green; }
        #results li.fail { color: red; }
    </style>
    <script src="jquery-1.9.0.min.js"></script>
    <script src="myFunctions.js"></script>
<!--<script src="mark.js"></script>
    <script src="spacefish.js"></script>        -->

</head>
<body>

    <canvas id="canvas" height="700" width="1200">Joo cannot see me!</canvas>

    <ul id="results"></ul>

    <script>
            var Game = function () {
                this.canvas = document.getElementById("canvas");
                this.ctx = canvas.getContext("2d");
                this.bufferCanvas = document.createElement("canvas");
                this.bufferCanvasCtx = this.bufferCanvas.getContext("2d");
                this.bufferCanvasCtx.canvas.width = this.ctx.canvas.width;
                this.bufferCanvasCtx.canvas.height = this.ctx.canvas.height;
                this.objects = [];
                this.events = [];
                this.score = 0;
                this.lives = 3;
            };
            var game = new Game();
            game.img = {};
            var imgArray = [
                "AGHeads", "bigBloater", "bigBloaterA", "bigBloaterB", "crabCakesA",
                "crabCakesB", "darkBack", "homingFishA", "homingFishB", "orbbouncy",
                "orbdrill", "orbhellfire", "orbhoming", "orblaser", "orbmega", "orbshock",
                "planetview", "seasky", "sinusoidSwimmerA", "sinusoidSwimmerB", "spaceShip",
                "spaceShipA", "spaceShipB", "spaceShipMegaA", "spaceShipMegaB", "spaceShipShield",
                "spaceShipShieldA", "spaceShipShieldB", "speedyBlueA", "speedyBlueB", "spitFireBulletA",
                "spitFireBulletB", "spitFireFishA", "spitFireFishB", "splitFishBigA", "splitFishBigB",
                "splitFishSmallA", "splitFishSmallB", "startScreen", "theSea", "trippyeyeballs",
                "youLose", "youWin"
            ];

            var splashHandler = function () {alert("I've been pressed"); loadGameLoop("secondScreen")};
            var secondScreen = function() {alert("I am the winner"); loadGameLoop("splashScreen")};

            (function loadImage(i) {
                i = (typeof i !== 'undefined') ? i : 0;
                var image = new Image();
                image.src = 'images/' + imgArray[i] + '.png';
                image.onload = function(e) {
                    window['game']['img'][imgArray[i]] = image;
                    i++;
                    if (i < imgArray.length) {
                        loadImage(i);
                    } else {
                        window.gameData = {
                            "splashScreen" : {"screen" : game.img.startScreen, "events" : function() {
                                game.canvas.removeEventListener('mousedown', secondScreen);
                                game.canvas.addEventListener('mousedown', splashHandler, false);
                            }},
                            "secondScreen" : {"screen" : game.img.youWin, "events" : function() {
                                game.canvas.removeEventListener('mousedown', splashHandler);
                                game.canvas.addEventListener('mousedown', secondScreen, false);
                            }}
                        }
                        loadGameLoop("splashScreen");
                    }
                };
            }());

            var testObj = { w:100, h:100, x:0, velx:1, y:0, vely:3 }

            var GameLoop = function(screen) {
                var self = this;

                this.isRunning = true;

                this.deleteEventHandlers = function() { game.events = []; }
                this.deleteGameObjects = function() { game.objects = []; }
                this.createEventHandlers = screen.events;
                this.createGameObjects = function() { assert(true, "I am setting new game objects"); }
                this.clearScreen = function() {
                    game.bufferCanvasCtx.drawImage(screen.screen, 0, 0);
                }
                this.update = function() {
                    if (testObj.x + testObj.w > game.ctx.canvas.width || testObj.x < 0) testObj.velx = -testObj.velx;
                    if (testObj.y + testObj.h > game.ctx.canvas.height || testObj.y < 0) testObj.vely = -testObj.vely;
                    testObj.x += testObj.velx;
                    testObj.y += testObj.vely;
                }
                this.render = function() {
                    game.bufferCanvasCtx.fillStyle = "yellow";
                    game.bufferCanvasCtx.fillRect(testObj.x, testObj.y, testObj.w, testObj.h);
                    game.ctx.drawImage(game.bufferCanvas, 0, 0, game.bufferCanvas.width, game.bufferCanvas.height);
                }
                this.animate = function() {
                    self.clearScreen();
                    self.update();
                    self.render();
                    if (self.isRunning) {
                        requestAnimationFrame(self.animate);
                    }
                }
            }

            function loadGameLoop(gameScreen) {
                game.gameLoop = new GameLoop(gameData[gameScreen]);
                for (var fn in game.gameLoop) {
                    if (typeof game.gameLoop[fn] == "function") {
                        game.gameLoop[fn]();
                    }
                }
            }

    </script>


</body>
</html>
